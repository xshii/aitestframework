<?xml version="1.0" encoding="UTF-8"?>
<svg width="900" height="600" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="xlsxGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="opsGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fa709a;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#fee140;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="dutGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ff6b6b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#c0392b;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="compareGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#4facfe;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#00f2fe;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="resultGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#43e97b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#38f9d7;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.2"/>
    </filter>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="450" y="35" font-family="Arial, sans-serif" font-size="22" font-weight="bold" text-anchor="middle" fill="#333">Workflow: xlsx Driven Comparison</text>

  <!-- Step 1: xlsx config -->
  <text x="100" y="70" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#555">Step 1</text>
  <g filter="url(#shadow)">
    <rect x="30" y="80" width="140" height="80" rx="8" fill="url(#xlsxGrad)"/>
    <text x="100" y="105" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">xlsx Config</text>
    <text x="100" y="125" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">op_registry sheet</text>
    <text x="100" y="140" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">ops sheet</text>
    <text x="100" y="155" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">compare sheet</text>
  </g>

  <!-- Arrow 1 -->
  <line x1="170" y1="120" x2="210" y2="120" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Step 2: Ops Execution -->
  <text x="340" y="70" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#555">Step 2</text>
  <g filter="url(#shadow)">
    <rect x="220" y="80" width="240" height="80" rx="8" fill="url(#opsGrad)"/>
    <text x="340" y="105" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Ops Execution</text>

    <rect x="235" y="115" width="100" height="35" rx="4" fill="white" fill-opacity="0.9"/>
    <text x="285" y="130" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#333">golden_python</text>
    <text x="285" y="142" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#666">or golden_cpp</text>

    <rect x="345" y="115" width="100" height="35" rx="4" fill="white" fill-opacity="0.9"/>
    <text x="395" y="130" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#333">reference</text>
    <text x="395" y="142" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#666">fp64 fuzz</text>
  </g>

  <!-- Arrow 2 -->
  <line x1="460" y1="120" x2="500" y2="120" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Step 3: Dump Binary -->
  <text x="600" y="70" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#555">Step 3</text>
  <g filter="url(#shadow)">
    <rect x="510" y="80" width="180" height="80" rx="8" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="2"/>
    <text x="600" y="105" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">dump() Binary Files</text>
    <text x="600" y="125" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">input_bin, weight_bin</text>
    <text x="600" y="140" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">golden_bin, reference_bin</text>
  </g>

  <!-- Vertical line down from dump -->
  <line x1="600" y1="160" x2="600" y2="200" stroke="#666" stroke-width="2"/>

  <!-- Branch point -->
  <circle cx="600" cy="200" r="5" fill="#666"/>

  <!-- Left branch to DUT -->
  <line x1="600" y1="200" x2="250" y2="200" stroke="#666" stroke-width="2"/>
  <line x1="250" y1="200" x2="250" y2="230" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Right branch to Compare -->
  <line x1="600" y1="200" x2="600" y2="350" stroke="#666" stroke-width="2" stroke-dasharray="5,3"/>

  <!-- Step 4: DUT Simulation -->
  <text x="250" y="225" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#555">Step 4</text>
  <g filter="url(#shadow)">
    <rect x="120" y="240" width="260" height="100" rx="8" fill="url(#dutGrad)"/>
    <text x="250" y="265" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">DUT Simulation</text>

    <rect x="135" y="280" width="110" height="45" rx="4" fill="white" fill-opacity="0.9"/>
    <text x="190" y="300" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#333">sim_cmd</text>
    <text x="190" y="315" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#666">{input_bin} {golden_bin}</text>

    <rect x="255" y="280" width="110" height="45" rx="4" fill="white" fill-opacity="0.9"/>
    <text x="310" y="300" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#333">result_bin</text>
    <text x="310" y="315" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#666">DUT output</text>
  </g>

  <!-- Arrow from DUT to Compare -->
  <line x1="380" y1="290" x2="430" y2="290" stroke="#666" stroke-width="2"/>
  <line x1="430" y1="290" x2="430" y2="380" stroke="#666" stroke-width="2"/>
  <line x1="430" y1="380" x2="480" y2="380" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Arrow from golden/reference to Compare -->
  <line x1="600" y1="350" x2="600" y2="380" stroke="#666" stroke-width="2"/>
  <line x1="600" y1="380" x2="690" y2="380" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Step 5: Compare -->
  <text x="600" y="340" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#555">Step 5</text>
  <g filter="url(#shadow)">
    <rect x="490" y="355" width="220" height="80" rx="8" fill="url(#compareGrad)"/>
    <text x="600" y="380" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">compare_full()</text>

    <text x="600" y="400" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">golden_bin vs result_bin</text>
    <text x="600" y="415" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">max_abs | qsnr | cosine</text>
    <text x="600" y="428" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#ddd">(reference_bin for fuzzy threshold)</text>
  </g>

  <!-- Arrow to Result -->
  <line x1="600" y1="435" x2="600" y2="465" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Step 6: Result & Update xlsx -->
  <text x="600" y="460" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#555">Step 6</text>
  <g filter="url(#shadow)">
    <rect x="420" y="475" width="360" height="70" rx="8" fill="url(#resultGrad)"/>
    <text x="600" y="500" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Update xlsx compare sheet</text>

    <rect x="440" y="510" width="70" height="25" rx="4" fill="#11998e"/>
    <text x="475" y="527" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">PASS</text>

    <rect x="520" y="510" width="70" height="25" rx="4" fill="#cb2d3e"/>
    <text x="555" y="527" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">FAIL</text>

    <rect x="600" y="510" width="80" height="25" rx="4" fill="#f7971e"/>
    <text x="640" y="527" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="#333">PENDING</text>

    <rect x="690" y="510" width="70" height="25" rx="4" fill="#95a5a6"/>
    <text x="725" y="527" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">SKIP</text>
  </g>

  <!-- Legend -->
  <g transform="translate(30, 400)">
    <text x="0" y="0" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">Binary Files:</text>
    <rect x="0" y="10" width="12" height="12" fill="#4facfe"/>
    <text x="18" y="20" font-family="Arial, sans-serif" font-size="9" fill="#333">input_bin / weight_bin (DUT input)</text>
    <rect x="0" y="28" width="12" height="12" fill="#43e97b"/>
    <text x="18" y="38" font-family="Arial, sans-serif" font-size="9" fill="#333">golden_bin / reference_bin (standard answer)</text>
    <rect x="0" y="46" width="12" height="12" fill="#ff6b6b"/>
    <text x="18" y="56" font-family="Arial, sans-serif" font-size="9" fill="#333">result_bin (DUT output)</text>
  </g>

  <!-- Footer -->
  <text x="450" y="580" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#999">AI Dev Tools v2.0 - xlsx Driven Comparison Workflow</text>
</svg>
