# AI测试框架 - AI模型测试需求
# 分类: AI模型测试 (AI Model Testing)
# 版本: 1.1.0
# 创建时间: 2026-02-02
# 更新时间: 2026-02-04
# 说明: 移除LLM专项测试，聚焦业务模型和算子验证，集成aidevtools

module:
  id: MODEL
  name: AI模型测试
  description: 针对业务模型和小模型的专项测试能力，集成aidevtools进行算子级验证

requirements:

  # ============================================
  # 模型加载与管理
  # ============================================
  - id: MODEL-001
    name: 模型加载器
    description: 支持多种格式的模型加载，优先使用aidevtools.ops
    priority: P1  # 降级：主要通过aidevtools.ops使用
    status: pending
    sub_requirements:
      - id: MODEL-001-01
        name: PyTorch模型加载
        description: 支持加载.pt/.pth格式的PyTorch模型
        priority: P1
        status: pending
      - id: MODEL-001-02
        name: ONNX模型加载
        description: 支持加载.onnx格式的通用模型
        priority: P1
        status: pending
      - id: MODEL-001-03
        name: 自定义模型加载器
        description: 支持用户自定义模型加载逻辑
        priority: P2
        status: pending

  - id: MODEL-002
    name: 模型版本管理
    description: 管理和追踪不同版本的模型
    priority: P1
    status: pending
    sub_requirements:
      - id: MODEL-002-01
        name: 模型版本标识
        description: 为每个模型分配唯一版本标识
        priority: P1
        status: pending
      - id: MODEL-002-02
        name: 模型元数据记录
        description: 记录模型的训练信息、参数量等元数据
        priority: P1
        status: pending
      - id: MODEL-002-03
        name: 多版本对比测试
        description: 支持同时测试多个版本进行对比
        priority: P2
        status: pending

  # ============================================
  # 推理测试（集成aidevtools）
  # ============================================
  - id: MODEL-003
    name: 推理正确性测试
    description: 基于aidevtools CompareEngine验证DUT输出正确性，支持四状态判定
    priority: P0
    status: pending
    sub_requirements:
      - id: MODEL-003-01
        name: 单算子比对测试
        description: 对单个算子输出进行四状态比对验证(PASS/GOLDEN_SUSPECT/DUT_ISSUE/BOTH_SUSPECT)
        priority: P0
        status: pending
      - id: MODEL-003-02
        name: 算子链比对测试
        description: 多算子串联的端到端比对验证
        priority: P0
        status: pending
      - id: MODEL-003-03
        name: 批量比对测试
        description: 批量数据的比对结果聚合
        priority: P0
        status: pending
      - id: MODEL-003-04
        name: 输出形状验证
        description: 验证输出张量的形状是否正确
        priority: P0
        status: pending
      - id: MODEL-003-05
        name: 确定性验证
        description: 验证相同输入产生相同输出
        priority: P1
        status: pending

  - id: MODEL-004
    name: 模型精度测试
    description: 基于aidevtools指标评估模型精度，支持QSNR、cosine等
    priority: P0
    status: pending
    sub_requirements:
      - id: MODEL-004-01
        name: QSNR指标
        description: 支持QSNR(量化信噪比)评估，集成aidevtools.compare
        priority: P0
        status: pending
      - id: MODEL-004-02
        name: Cosine相似度
        description: 支持余弦相似度评估
        priority: P0
        status: pending
      - id: MODEL-004-03
        name: 最大绝对误差
        description: 支持max_abs误差评估
        priority: P0
        status: pending
      - id: MODEL-004-04
        name: 分类精度指标
        description: 支持accuracy、precision、recall、F1等
        priority: P1
        status: pending
      - id: MODEL-004-05
        name: 回归精度指标
        description: 支持MSE、MAE、RMSE等
        priority: P1
        status: pending
      - id: MODEL-004-06
        name: 精度阈值断言
        description: 设置精度阈值，低于阈值则测试失败
        priority: P0
        status: pending

  # ============================================
  # 性能测试
  # ============================================
  - id: MODEL-005
    name: 推理性能测试
    description: 测试模型推理的性能表现
    priority: P0
    status: pending
    sub_requirements:
      - id: MODEL-005-01
        name: 推理延迟测试
        description: 测量单次推理的延迟时间
        priority: P0
        status: pending
      - id: MODEL-005-02
        name: 吞吐量测试
        description: 测量单位时间内的推理次数
        priority: P0
        status: pending
      - id: MODEL-005-03
        name: 内存占用测试
        description: 测量推理过程的内存消耗
        priority: P1
        status: pending
      - id: MODEL-005-04
        name: 不同批次性能测试
        description: 测试batch_size=1/8/16/32等不同批次的性能
        priority: P0
        status: pending
      - id: MODEL-005-05
        name: 预热运行支持
        description: 支持预热运行排除冷启动影响
        priority: P1
        status: pending
      - id: MODEL-005-06
        name: 性能基准对比
        description: 与历史基准数据进行对比
        priority: P1
        status: pending

  - id: MODEL-006
    name: 压力测试
    description: 在高负载下测试模型稳定性
    priority: P1
    status: pending
    sub_requirements:
      - id: MODEL-006-01
        name: 并发请求测试
        description: 模拟多个并发推理请求
        priority: P1
        status: pending
      - id: MODEL-006-02
        name: 长时间运行测试
        description: 长时间持续推理的稳定性测试
        priority: P1
        status: pending
      - id: MODEL-006-03
        name: 内存泄漏检测
        description: 检测长时间运行是否存在内存泄漏
        priority: P1
        status: pending

  # ============================================
  # 鲁棒性测试
  # ============================================
  - id: MODEL-007
    name: 输入鲁棒性测试
    description: 测试模型对各种输入的鲁棒性
    priority: P1
    status: pending
    sub_requirements:
      - id: MODEL-007-01
        name: 边界值测试
        description: 测试极端输入值的处理
        priority: P1
        status: pending
      - id: MODEL-007-02
        name: 异常输入测试
        description: 测试空值、NaN、Inf等异常输入
        priority: P1
        status: pending
      - id: MODEL-007-03
        name: 噪声注入测试
        description: 在输入中添加噪声测试稳定性
        priority: P1
        status: pending

  # ============================================
  # 一致性测试（量化场景核心）
  # ============================================
  - id: MODEL-008
    name: 模型一致性测试
    description: 验证模型在不同环境和量化条件下的一致性
    priority: P0
    status: pending
    sub_requirements:
      - id: MODEL-008-01
        name: CPU/GPU一致性
        description: 验证CPU和GPU推理结果一致
        priority: P0
        status: pending
      - id: MODEL-008-02
        name: 不同批次大小一致性
        description: 验证不同batch size结果一致
        priority: P1
        status: pending
      - id: MODEL-008-03
        name: 量化模型一致性
        description: 验证量化前后精度损失在可接受范围，集成aidevtools量化格式
        priority: P0  # 提升：这是核心场景
        status: pending
      - id: MODEL-008-04
        name: Golden自检
        description: 基于aidevtools.sanity验证Golden数据有效性(non_zero/no_nan_inf/qsnr_valid)
        priority: P0
        status: pending
